<!DOCTYPE HTML>
<html lang="fa" class="sidebar-visible no-js dark" dir="rtl">
    <head>
        <meta charset="UTF-8">
        <title>سرور - مستندات نیکاس</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="The first Persian comment platform.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#0f1419" />
        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@30.1.0/dist/Farsi-Digits/font-face-FD.css">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">
    </head>
    <body>
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "dark";
        </script>
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>
        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html">نیکاس</a></li><li class="chapter-item expanded "><a href="../introducing/index.html">معرفی</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../introducing/introducing.html">نیکاس چیست ؟</a></li><li class="chapter-item expanded "><a href="../introducing/similar.html">نمونه های مشابه</a></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/index.html">شروع به کار</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/requirements.html">پیش نیاز ها</a></li><li class="chapter-item expanded "><a href="../getting-started/install.html">نصب</a></li><li class="chapter-item expanded "><a href="../getting-started/run.html">اجرا</a></li></ol></li><li class="chapter-item expanded "><a href="../config/index.html">تنظیمات</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../config/server.html" class="active">سرور</a></li><li class="chapter-item expanded "><a href="../config/client.html">کلاینت</a></li><li class="chapter-item expanded "><a href="../config/docker.html">داکر</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>
        <div id="page-wrapper" class="page-wrapper">
            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                    <h1 class="menu-title">مستندات نیکاس</h1>
                    <div class="right-buttons">
                        <a href="https://github.com/Nikas-Project/Documentation" title="Git repository" aria-label="Git repository" target="_blank">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/Nikas-Project/Documentation/edit/master/src/config/server.md?mode&#x3D;edit" title="Suggest an edit" aria-label="Suggest an edit" target="_blank">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="جستجو در مستندات ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>
                <div id="content" class="content">
                    <main>
                        <h1 id="تنظیمات-سرور"><a class="header" href="#تنظیمات-سرور">تنظیمات سرور</a></h1>
<p>فایل تنظیمات سرور نیکاس با فرمت <a href="https://en.wikipedia.org/wiki/INI_file">INI</a> در نظر گرفته شده است. در این فایل به ازای هر بخش از سرور گزینه های مورد نظر خودمان را تعریف می کنیم. فایل نمونه را در <a href="https://github.com/Nikas-Project/Server/blob/master/example.cfg">این آدرس</a> می‎توانید مشاهده کنید. این فایل بدین صورت می‎باشد :</p>
<pre><code class="language-ini">[general]
dbpath = example.db
host = https://arash-hatami.ir/

[server]
listen = http://localhost:1234/

[admin]
enabled = true
password = secret_token
</code></pre>
<p>جهت استفاده از این فایل آن را با گزینه <code>c-</code> به دستور اجرایی خود اضافه کنید یا از متغیر های ENV استفاده کنید :</p>
<pre><code class="language-bash">nikas -c nikas.cfg
# or
env NIKAS_SETTINGS=path/to/nikas.cfg nikas
</code></pre>
<hr />
<p>حال به بررسی تنظیمات مختلف سرور می‎پردازیم :</p>
<ul>
<li><a href="#general">General</a></li>
<li><a href="">Moderation</a></li>
<li><a href="">Server</a></li>
<li><a href="">SMTP</a></li>
<li><a href="">Guard</a></li>
<li><a href="">Markup</a></li>
<li><a href="">Hash</a></li>
<li><a href="">RSS</a></li>
<li><a href="">Admin</a></li>
<li><a href="">Environment variables</a></li>
</ul>
<h2 id="general"><a class="header" href="#general">General</a></h2>
<p>در این بخش تمامی تنظیمات عمومی نیکاس انجام می شود. مقدار پیشفرض آن به این شکل است :</p>
<pre><code class="language-ini"># Default
[general]
dbpath = /tmp/nikas.db
name =
host =
max-age = 15m
notify = stdout
log-file =
</code></pre>
<h3 id="dbpath"><a class="header" href="#dbpath">dbpath</a></h3>
<p>آدرس فایل پایگاه داده SQLite3. این آدرس باید در پوشه غیرموقت باشد تا پایگاه داده شما حذف نشود</p>
<h3 id="name"><a class="header" href="#name">name</a></h3>
<p>برای استفاده در حالتی به کار می رود که شما چند وبسایت تعریف کرده باشید. در غیر اینصورت اجباری نیست.</p>
<h3 id="host"><a class="header" href="#host">host</a></h3>
<p>در اینجا باید وبسایت(ها) را تعریف کنید. شما جهت اجرا به حداقل یک وبسایت نیاز دارید. هدف از این بخش مسائل امنیتی بوده و به دلیل استفاده از <a href="https://developer.mozilla.org/en/docs/HTTP/Access_control_CORS">CORS</a> جهت محدود کردن نمایش نظرات در وب سایت مقصد باید آدرس وبسایت های خودتان را تعریف کنید.</p>
<p>پیشنهاد می شود ابتدا وبسایت های HTTP را تعریف کنید ( non-SSL ).</p>
<pre><code class="language-ini">[general]
host =
    http://website.ir/
    https://website.ir/
</code></pre>
<blockquote>
<p>در صورتی که نیکاس نتواند هنگام اجرای اولیه به حداقل یکی از این وبسایت ها متصل شود ، پیغام خطایی در ترمینال داده می‎شود.</p>
</blockquote>
<h3 id="max-age"><a class="header" href="#max-age">max-age</a></h3>
<p>بازه زمانی مجاز که به کاربران اجازه ی ویرایش یا حذف نظرات داده می شود.</p>
<h3 id="notify"><a class="header" href="#notify">notify</a></h3>
<p>سیستم اعلام دریافت نظر برای نظرات جدید :</p>
<ul>
<li><strong>stdout</strong> : این مورد به صورت پیشفرض فعال بوده و نظرات جدید در قالب خروجی عادی در ترمینال نمایش داده می شوند</li>
<li><strong>smtp</strong> : اعلان از طریق ایمیل برای شما ارسال خواهد شد. توجه داشته باشید که در صورت استفاده از این گزینه باید تنظیمات <a href="#smtp">SMTP</a> را نیز انجام دهید.</li>
</ul>
<h3 id="reply-notifications"><a class="header" href="#reply-notifications">reply-notifications</a></h3>
<p>با استفاده از این گزینه به کاربران اجازه داده می شود تا تعیین کنند در صورت ثبت پاسخ برای نظرشان به آنها ایمیلی ارسال شود.</p>
<blockquote>
<p>قبل از استفاده این مورد حتما تنظیمات مناسب را در قسمت <a href="#moderation">Moderation</a> انجام دهید تا از اسپم ها جلوگیری شود. همچنین باید تنظیمات <a href="#smtp">SMTP</a> نیز انجام شده باشد</p>
</blockquote>
<h3 id="log-file"><a class="header" href="#log-file">log-file</a></h3>
<p>با استفاده از این گزینه تمامی رخداد ها با جای اینکه در خروجی ترمینال نمایش داده شوند در یک فایل ذخیره خواهند شد.</p>
<h3 id="gravatar"><a class="header" href="#gravatar">gravatar</a></h3>
<p>در صورتی که این گزینه را فعال کنید ، نیکاس از <a href="https://en.wikipedia.org/wiki/Gravatar">Gravatar</a> برای نمایش تصویر کاربران استفاده خواهد کرد. البته به شرطی که کاربر مورد نظر هنگام ارسال نظر آدرس ایمیل خودش رو نیز ثبت کرده باشه. در غیر اینصورت یک آیکون رندوم به آن اختصاص داده می شود.</p>
<p><img src="../images/gravatar.png" alt="gravatar" /></p>
<h2 id="moderation"><a class="header" href="#moderation">Moderation</a></h2>
<p>در این قسمت Queue پردازش برای نظرات جدید را فعال می کنیم.</p>
<pre><code class="language-ini"># Default
[moderation]
enabled = false
approve-if-email-previously-approved = false
purge-after = 30d
</code></pre>
<h3 id="enabled"><a class="header" href="#enabled">enabled</a></h3>
<p>فعال کردن گزینه مدیریت. بدین صورت که نظرات پس از ثبت باید توسط مدیریت تایید شوند. نظرات تایید شده به صورت عمومی نمایش داده نخواهند شد.</p>
<h3 id="approve-if-email-previously-approved"><a class="header" href="#approve-if-email-previously-approved">approve-if-email-previously-approved</a></h3>
<p>اگر این گزینه فعال باشد ؛ در صورتی که کاربر مورد نظر با ایمیل وارد شده حداقل در 6 ماه گذشته یک نظر تایید شده داشته باشد ، نظر فعلی وی نیز خودکار تایید خواهد شد.</p>
<blockquote>
<p>این گزینه کاربردی است ولی اگر کاربری به طور اتفاقی آدرس ایمیل درستی را حدث بزند یا به جای فرد دیگری که آن را می شناسد نظری با آدرس ایمیل وی ثبت کند می تواند نظر اسپم در سایت نمایش دهد. <strong>پس با ریسک خودتان این گزینه را فعال نمایید</strong></p>
</blockquote>
<h3 id="purge-after"><a class="header" href="#purge-after">purge-after</a></h3>
<p>با استفاده از این گزینه می توانید مشخص کنید نظرات تایید نشده پس از چند روز به طور خودکار حذف شوند</p>
<h2 id="server"><a class="header" href="#server">Server</a></h2>
<p>تنظیمات اصلی HTTP Server نیکاس در این بخش صورت می‎پذیرد.</p>
<pre><code class="language-ini"># Default
[server]
listen = http://localhost:8080
reload = off
profile = off
</code></pre>
<h3 id="listen"><a class="header" href="#listen">listen</a></h3>
<p>آدرسی که باید سرور با آن کار کند. نیکاس از TCP/IP و UNIX domain socket پشتیبانی می‎کند</p>
<pre><code class="language-ini"># UNIX domain socket
listen = unix:///tmp/nikas.sock
# TCP/IP
listen = http://localhost:1234/
</code></pre>
<p>در نیکاس از <a href="https://github.com/gevent/gevent">gevent</a> استفاده شده است و به طور خودکار برای TCP/IP به کار می‎رود اما نمی‎تواند درخواست های HTTP را روی UNIX domain socket مدیریت کند.</p>
<blockquote>
<p>جهت اطلاعات بیشتر به <a href="https://github.com/surfly/gevent/issues/299">#299</a> و <a href="https://github.com/surfly/gevent/issues/295">#295</a> مراجعه کنید.</p>
</blockquote>
<h3 id="public-endpoint"><a class="header" href="#public-endpoint">public-endpoint</a></h3>
<p>آدرس عمومی که سرور نیکاس با آن در دسترس خواهد بود. برای مثال <code>nikas.domain.ir</code>. باید به صورت آدرس کامل نوشته شود :</p>
<pre><code class="language-ini">public-endpoint = https://nikas.domain.ir
</code></pre>
<p>در صورتی که این مقدار خالی گذاشته شود نیکاس سعی می کند به طور خودکار آدرس را تشخیص دهد. از این مقدار وقتی استفاده کنید که آدرس عمومی با آدرس تعیین شده در <code>listen</code> متفاوت باشد.</p>
<blockquote>
<p>برای مثال وقتی از Docker استفاده می کنید آدرس های listen و public با یکدیگر متفاوت هستند</p>
</blockquote>
<h3 id="reload"><a class="header" href="#reload">reload</a></h3>
<p>با فعال کردن این گزینه در صورتی که سورس برنامه تغییر کند ، نیکاس ریستارت می شود. فقط برای حالت توسعه مناسب است و در محیط عملیاتی Production کاربردی ندارد</p>
<h3 id="samesite"><a class="header" href="#samesite">samesite</a></h3>
<p>این گزینه مقدار <code>Set-Cookie</code> را در <code>SameSite</code> تعیین می‎کند. زمانی به کار می رود که نیکاس در دامنه یکسانی هاست نشده باشد. برای مثال از <code>domain.ir</code> فراخوانی شده و در <code>comments.domain.ir</code> هسات شده است.</p>
<p>به صورت پیشفرض نیکاس مقدار <code>SameSite=None</code> را برای ارتباط https و <code>SameSite=Lax</code> را برای http در نظر می‎گیرد.</p>
<blockquote>
<p>جهت اطلاعات بیشتر به <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite">MDM: SameSite</a> مراجعه کنید</p>
</blockquote>
<p>مقادیر قابل تعریف در این بخش : <code>None</code>, <code>Lax</code>, <code>Strict</code></p>
<h2 id="smtp"><a class="header" href="#smtp">SMTP</a></h2>
<p>نیکاس می‎تواند از طریق ارسال ایمیل شما را از ثبت نظر های جدید اگاه کند. همچنین در ایمیل های دریافتی توانایی تایید یا حذف نظرها را نیز دارید.</p>
<p>جهت این کار باید یک سرور ایمیل داشته باشید و به عنوان SMTP Server در نیکاس تعریف کنید.</p>
<pre><code class="language-ini">[smtp]
# Default
username =
password =
host = localhost
port = 587
security = starttls
to =
from =
timeout = 10
</code></pre>
<h3 id="username"><a class="header" href="#username">username</a></h3>
<p>نام کاربری سرور ایمیل</p>
<h3 id="password"><a class="header" href="#password">password</a></h3>
<p>کلمه عبور سرور ایمیل</p>
<blockquote>
<p>پیشنهاد می شود یک حساب کاربری جدا برای این کار در نظر بگیرید</p>
</blockquote>
<h3 id="host-1"><a class="header" href="#host-1">host</a></h3>
<p>آدرس آی پی یا دامنه سرور ایمیل</p>
<h3 id="port"><a class="header" href="#port">port</a></h3>
<p>پورت سرور ایمیل</p>
<h3 id="security"><a class="header" href="#security">security</a></h3>
<p>استفاده از اتصال ایمن و رمز شده SSL برای اتصال به سرور ایمیل. مقادیر قابل تعریف : <code>none</code>, <code>starttls</code>, <code>ssl</code>.</p>
<blockquote>
<p>متاسفانه پیاده سازی اعتبارسنجی گواهینامه ها در پایتون سخت تر از چیزی است که فکر می کنید. نیکاس به طور ساده و با استفاده از کتابخانه های آماده ای که وجود داره این کار رو انجام میده و در مواردی معتبر نبودن گواهینامه هارو میتونه Ignore کنه. ترجیحا از موارد معتبر استفاده کنید و حتما برای نیکاس از حساب کاربری ایمیل مجزا استفاده کنید.</p>
</blockquote>
<h3 id="to"><a class="header" href="#to">to</a></h3>
<p>آدرس ایمیل مقصد که می‎خواهید برای آن هشدار ها ارسال شود</p>
<h3 id="from"><a class="header" href="#from">from</a></h3>
<p>آدرس فرستنده ، برای مثال : <code>Nikas &lt;nikas@domain.ir&gt;</code></p>
<h3 id="timeout"><a class="header" href="#timeout">timeout</a></h3>
<p>اختصاص timeout به صورت ثانیه جهت اتمام عملیات های مربوط به ایمیل مانند ارسال یا اتصال به سرور</p>
<h2 id="guard"><a class="header" href="#guard">Guard</a></h2>
<p>نیکاس یک سیستم داخلی جهت تشخیص و جلوگیری از اسپم نیز دارد. در این بخش می توانید آن را فعال و تنظیم نمایید. اصلی ترین حساسیت آن به صورت rate-limit بر اساس آدرس آی پی می باشد.</p>
<pre><code class="language-ini"># Default
[guard]
enabled = true
ratelimit = 2
direct-reply = 3
reply-to-self = false
require-author = false
require-email = false
</code></pre>
<h3 id="enabled-1"><a class="header" href="#enabled-1">enabled</a></h3>
<p>فعال کردن سیستم ضداسپم</p>
<h3 id="ratelimit"><a class="header" href="#ratelimit">ratelimit</a></h3>
<p>اعمال محدودیت بر اساس تعداد نظر بر دقیقه. برای مثال <code>ratelimit = 2</code> یعنی به هر آدرس آی پی اجازه داده می شود در هر دقیقه فقط 2 نظر ارسال کند.</p>
<h3 id="direct-reply"><a class="header" href="#direct-reply">direct-reply</a></h3>
<p>با استفاده از این گزینه می‎توانید مشخص کنید چه تعداد نظر به صورت مستقیم به هر تاپیک ارسال شود.</p>
<h3 id="reply-to-self"><a class="header" href="#reply-to-self">reply-to-self</a></h3>
<p>به کاربران اجازه داده می شود تا برای نظرات خودشان پاسخی ثبت کنند. البته این مورد فقط برای وقتی است که آنها هنوز فرصت ویرایش نظر را دارند. پس از آن که مسلما هر کاربری می تواند به نظر خودش پاسخ دهد.</p>
<h3 id="require-author"><a class="header" href="#require-author">require-author</a></h3>
<p>با فعال کردن این گزینه کاربران مجبور به ثبت نام خود برای ارسال نظر می‎شوند.</p>
<blockquote>
<p>باید کلاینت را نیز تنظیم کنید</p>
</blockquote>
<h3 id="require-email"><a class="header" href="#require-email">require-email</a></h3>
<p>با فعال کردن این گزینه کاربران مجبور می‎شوند جهت ثبت نظر آدرس ایمیل خود را نیز وارد کنند.</p>
<blockquote>
<p>باید کلاینت را نیز تنظیم کنید</p>
</blockquote>

                    </main>
                    <nav class="nav-wrapper" aria-label="Page navigation">
                            <a rel="prev" href="../config/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../config/client.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>
            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../config/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../config/client.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>
        </div>
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>
    </body>
</html>
